# API 密钥管理功能

## 功能概述

Smart Domain 项目现已支持 API 密钥管理功能，用户可以生成、管理和使用 API 密钥来访问我们的 API 服务。

## 数据库设置

### 1. 执行数据库迁移

在 Supabase SQL Editor 中执行 `API_KEYS_SETUP.sql` 文件来创建所需的数据库表和安全策略。

### 2. 表结构

- **api_keys**: 存储用户的 API 密钥信息
- **api_key_usage**: 记录 API 密钥的使用情况（可选）

## 功能特性

### 🔐 安全性

- API 密钥使用 SHA-256 哈希存储
- 只显示密钥前缀，保护完整密钥
- Row Level Security (RLS) 确保用户只能访问自己的密钥
- 新生成的密钥只显示一次

### 🛠️ 管理功能

- 创建新的 API 密钥
- 为密钥添加名称和描述
- 查看密钥创建时间和最后使用时间
- 删除不需要的密钥
- 一键复制密钥到剪贴板

### 📊 使用统计

- 记录每个密钥的使用情况
- 显示最后使用时间
- 支持查看详细的使用记录

## 使用方法

### 1. 访问 API 密钥管理

用户可以通过以下方式访问：

- 登录后点击用户头像 → 设置 → API密钥
- 或者在控制台页面点击"管理 API 密钥"

### 2. 创建 API 密钥

1. 点击"创建API密钥"按钮
2. 输入密钥名称（必填）
3. 输入描述（可选）
4. 点击"创建"
5. **立即复制并保存密钥（只显示一次）**

### 3. 使用 API 密钥

在 HTTP 请求头中包含 API 密钥：

```bash
curl -H "Authorization: Bearer YOUR_API_KEY" \
     https://your-domain.com/api/domains/check
```

### 4. 管理现有密钥

- 查看密钥列表和基本信息
- 删除不需要的密钥
- 查看使用统计

## API 密钥格式

生成的 API 密钥格式为：`sd_[timestamp]_[random32chars]`

示例：`sd_123456789_AbCdEfGhIjKlMnOpQrStUvWxYz123456`

## 安全建议

1. **妥善保管**：API 密钥只显示一次，请立即复制并安全保存
2. **定期轮换**：建议定期更换 API 密钥
3. **环境分离**：为不同环境（开发、测试、生产）使用不同的密钥
4. **最小权限**：只为必要的应用分配 API 密钥
5. **监控使用**：定期检查 API 密钥的使用情况

## 限制

- 每个用户最多可以创建 10 个 API 密钥
- 每个密钥的请求限制为 1000次/小时
- API 密钥永不过期（可选择设置过期时间）

## 故障排除

### 1. 无法创建 API 密钥

- 检查是否已登录
- 确认数据库连接正常
- 检查是否达到密钥数量限制

### 2. API 密钥无法使用

- 验证密钥格式是否正确
- 检查 Authorization 头是否正确设置
- 确认密钥未被删除或过期

### 3. 数据库错误

- 确认已执行数据库迁移脚本
- 检查 RLS 策略是否正确设置
- 验证用户权限

## 技术实现

- **前端**: React + TypeScript + Supabase Client
- **后端**: Supabase Auth + RLS
- **安全**: SHA-256 哈希 + 安全随机生成
- **UI**: shadcn/ui 组件库

## 未来计划

- [ ] API 使用量统计和图表
- [ ] API 密钥权限控制
- [ ] 密钥过期时间设置
- [ ] Webhook 支持
- [ ] API 文档集成
